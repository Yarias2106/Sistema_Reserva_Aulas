{% extends 'BaseHeaderFooter.html' %}

 {% block title %}
     Vista Docente
 {% endblock %}

{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static '/css/FormularioReserva.css' %}">

<section class="BodyFont mx-4">
    <div class="container formReserva col-md-6">
        <div class="row px-4">
            <h4 class="text-center text-white pt-3 col-12">Parametrización</h4>
            <center>
              <div id="ventana">
                <!-- Aqui van los mensajes -->
              </div>
            </center>
            <h6 class="text-white col-12 pt-2">Rango de fechas límite de reserva de ambiente</h6>
        </div>
        <!-- <form action="/ConfigurarParametros/" method="POST" class="row g-3 p-4"> -->
        <div class="row g-3 p-4">
        {% csrf_token %} 

            <div class="col-lg-6 col-md-12 col-sm-12 col-12" style="display: flex; align-items: center;">
            <label for="input-label" class="form-label text-white me-3">Mínimo de reserva (días) </label>
            <input type="number" name="min" id="min" class="form-control" value="{{rango.Minimo}}" min="1" max="30" style="width:4rem;" required>
            </div>
    
            <div class="col-lg-6 col-md-12 col-sm-12 col-12" style="display: flex; align-items: center;">
            <label for="inputState" class="form-label text-white me-3">Máximo de reserva (días) </label>
            <input type="number" name="max" id="max" class="form-control" value="{{rango.Maximo}}" min="1" max="30" style="width:4rem;" required>
            </div>
            <div class="col-12">
            <center><input type="submit" class="btn btn-primary" value="Guardar" onclick="guardar()"></input></center>
            <!-- <center><button type="button" id="liminar" class="btn btn-primary" onclick="guardar()">Guardar</button></center> Hola -->
            </div>
         </div>
    </div>
  </section>
{% endblock %}  

{% block scripts %}
<script>
    function guardar(){
    let minimo = parseInt(document.getElementById('min').value);
    let maximo = parseInt(document.getElementById('max').value);
    
    if(minimo < 1){
      crearMensaje("El valor del rango mínimo no puede ser menor a 1");
    }
    if(maximo < 1){
      crearMensaje("El valor del rango máximo no puede ser menor a 1");
    }
    if(minimo > maximo){
      crearMensaje("El valor del rango mínimo no puede ser mayor al rango máximo");
    }
    if(minimo === maximo){
      crearMensaje("El valor del rango mínimo y máximo no pueden ser iguales");
    }
    if((minimo >= 1) && (maximo <= 30) && (minimo < maximo)){
        console.log("si esta entrando")
        let rutaActual = location.href
        console.log(rutaActual)
        let ruta = rutaActual.replace("ConfigurarParametros/", "VistaAdmin/");
        console.log(ruta)
        
        console.log(`este es el max ${maximo} y el min: ${minimo}`)
          Swal.fire({
          title: '¿Está seguro de guardar los cambios?',
          //text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          cancelButtonText: 'Cancelar',
          confirmButtonText: 'Aceptar'
        }).then((result) => {
          if (result.isConfirmed) {
            $.ajax({
            type: "GET",
            url: '/ConfigurarParametros',
            data: {
                'min' : minimo,
                'max' : maximo
              },
            });
            Swal.fire({
            title: '¡Datos guardados exitosamente!',
            icon: 'success',
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Ok'
            }).then((result) => {
                if (result.isConfirmed) {
                    location.href = ruta
                }
            })
          }
        })
    };
};
function crearMensaje(mensaje){
    let ventana = document.getElementById('ventana');
    ventana.innerHTML = `<div id="VentanaHijo" class="alert alert-danger alert-dismissible fade show alertaCol"     role="alert">${mensaje}</div>`;
    setTimeout(() => {
          document.getElementById('VentanaHijo').remove();
    },4000);         
};
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
{% endblock %}